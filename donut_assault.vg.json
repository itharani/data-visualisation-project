{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "height": 250,
  "width": 250,
  "title": "Assault Cases in 2023",
  "description": "A donut chart of assault data with properly aligned category labels.",
  "data": {
    "values": [
      {"category": "Murder", "value": 258},
      {"category": "Rape", "value": 1914},
      {"category": "Robbery", "value": 4588},
      {"category": "Causing injury", "value": 4693}
    ]
  },
  "transform": [
    {
      "window": [{"op": "sum", "field": "value", "as": "TotalValue"}],
      "frame": [null, null]
    },
    {
      "calculate": "datum.value / datum.TotalValue * 100",
      "as": "Percentage"
    },
    {
      "calculate": "format(datum.Percentage, '.1f') + '%'",
      "as": "PercentageLabel"
    },
    {
      "sort": [{"field": "value", "order": "descending"}]
    }
  ],
  "layer": [
    {
      "mark": {"type": "arc", "innerRadius": 50, "outerRadius": 100},
      "encoding": {
        "theta": {
          "field": "value",
          "type": "quantitative",
          "stack": true
        },
        "color": {
          "field": "category",
          "type": "nominal",
          "scale": {
            "scheme": "darkred"
          },
          "legend":null
        }
      }
    },
    {
      "mark": {
        "type": "text",
        "radiusOffset": -15,  
        "fontWeight": "bold",
        "fontSize": 10
      },
      "encoding": {
        "theta": {
          "field": "value",
          "type": "quantitative",
          "stack": true
        },
        "radius": {"value": 90},
        "text": {"field": "category", "type": "nominal"},
        "color": {"value": "white"}
      }
    },
    {
      "mark": {
        "type": "text",
        "fontSize": 30,
        "fontWeight": "bold",
        "color": "black"
      },
      "encoding": {
        "text": {"value": "19.93%"}  
      }
    }
  ]
}
